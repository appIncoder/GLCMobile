<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title>Soutenir le GLC Baudour</ion-title>
  </ion-toolbar>
</ion-header>



<ion-content [fullscreen]="true" class="soutenir-page">
  <div class="soutenir-container">
    <!-- Image Card -->
    <ion-card button>
      <ion-card-content>
        <ion-img src="assets/don-e1591375718487.jpg" alt="Logo GLC Baudour" class="soutenir-logo" />
      </ion-card-content>
    </ion-card>

    <!-- Description Card -->
    <ion-card>
      <ion-card-content>
        <p>
          Soutenir le GLC Baudour financièrement est bien plus qu'une simple donation. C'est un acte d'adoration, 
          une expression de votre foi et de votre engagement envers la mission de partage de l'Évangile. 
          Chaque contribution, quelle que soit son montant, aide à:
        </p>
        <ul>
          <li>Financer nos activités spirituelles et communautaires</li>
          <li>Soutenir nos missions humanitaires</li>
          <li>Développer nos programmes d'éducation et de formation</li>
          <li>Étendre notre rayonnement dans la région</li>
        </ul>
        <p>
          En donnant, vous devenez partenaire de Dieu dans son œuvre. Votre générosité inspire d'autres 
          et transforme des vies. Nous vous remercions sincèrement pour votre soutien.
        </p>
      </ion-card-content>
    </ion-card>

    <!-- Pay Button -->
    <ion-button class="don-btn" color="primary" (click)="openPaymentModal()">
      Faire un don
    </ion-button>
  </div>

  <!-- Payment Modal -->
  <ion-modal
    [isOpen]="isPaymentModalOpen"
    (didDismiss)="closePaymentModal()"
  >
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-title>Paiement Sécurisé</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="closePaymentModal()">Fermer</ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>

      <ion-content class="payment-modal">
        <ion-card>
          <ion-card-content>
            <!-- Step 1: Amount Selection -->
            <div *ngIf="!paymentErrorMessage && !paymentSuccessMessage && !selectedAmount">
              <p class="payment-description">Sélectionnez un montant pour soutenir le GLC Baudour</p>

              <ion-grid>
                <ion-row>
                  <ion-col size="6" *ngFor="let option of paymentOptions">
                    <ion-button
                      [fill]="selectedAmount === option.amount ? 'solid' : 'outline'"
                      [color]="selectedAmount === option.amount ? 'primary' : 'medium'"
                      expand="block"
                      (click)="selectAmount(option.amount)"
                      class="payment-option-btn"
                    >
                      {{ option.label }}
                    </ion-button>
                  </ion-col>
                </ion-row>
              </ion-grid>

              <ion-button
                expand="block"
                color="primary"
                [disabled]="!selectedAmount"
                (click)="processPayment()"
                class="payment-submit-btn"
              >
                Continuer
              </ion-button>
            </div>

            <!-- Step 2: Card Payment Form -->
            <div *ngIf="selectedAmount && !paymentSuccessMessage">
              <div class="amount-display">
                <p class="amount-label">Montant à payer</p>
                <p class="amount-value">€{{ selectedAmount }}.00</p>
              </div>

              <app-stripe-card-form 
                [amount]="selectedAmount"
                (paymentSubmit)="handleCardPayment($event)"
              ></app-stripe-card-form>

              <!-- Error Message -->
              <div *ngIf="paymentErrorMessage" class="error-box">
                <p>{{ paymentErrorMessage }}</p>
                <ion-button
                  expand="block"
                  fill="outline"
                  color="medium"
                  (click)="selectedAmount = null"
                  size="small"
                >
                  Retour
                </ion-button>
              </div>
            </div>

            <!-- Success Message -->
            <div *ngIf="paymentSuccessMessage" class="success-box">
              <p class="success-icon">✓</p>
              <p class="success-message">{{ paymentSuccessMessage }}</p>
            </div>
          </ion-card-content>
        </ion-card>
      </ion-content>
    </ng-template>
  </ion-modal>
