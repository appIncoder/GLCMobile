<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title>GLC Media</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="glcmedia-page">
  <ion-refresher slot="fixed" (ionRefresh)="doRefresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <div #mediaWrapper class="media-container">
    <!-- Onglets + indication swipe -->
    <div class="media-tabs">
      <button
        class="media-tab"
        [class.active]="activeTab === 'videos'"
        (click)="switchToTab('videos')"
      >
        Vid√©os
      </button>
      <button
        class="media-tab"
        [class.active]="activeTab === 'podcasts'"
        (click)="switchToTab('podcasts')"
      >
        Podcasts
      </button>
    </div>

    <div class="media-swipe-hint" style="text-align: center;">
      Swipe üëâ pour passer des vid√©os üëà aux podcasts.
    </div>

    <!-- Slider horizontal -->
    <div class="media-slider" [class.show-podcasts]="activeTab === 'podcasts'">

      <!-- üü• Panneau VID√âOS -->
      <div class="media-panel videos-panel">
        <div class="media-intro">
          Retrouvez ici les derni√®res vid√©os publi√©es sur la cha√Æne YouTube du GLC Baudour.
        </div>

        <!-- √âtat de chargement -->
        <div *ngIf="isLoadingVideos" class="media-state">
          Chargement des vid√©os‚Ä¶
        </div>

        <!-- Erreur -->
        <div *ngIf="!isLoadingVideos && errorVideos" class="media-state error">
          {{ errorVideos }}
        </div>

        <!-- Liste des vid√©os -->
        <div *ngIf="!isLoadingVideos && !errorVideos" class="video-list">
          <ion-card
            class="video-card"
            *ngFor="let video of videos"
            button
            (click)="openYoutubeVideo(video)"
          >
            <ion-img
              class="video-thumbnail"
              [src]="video.thumbnailUrl"
              [alt]="video.title"
            ></ion-img>

            <ion-card-content>
              <div class="video-header">
                <h2 class="video-title">{{ video.title }}</h2>
                <p class="video-date w-100">
                  {{ video.publishedAt | date: 'longDate' }}
                </p>

                <!-- Optionnel : bouton explicite (√©vite d‚Äôouvrir si l‚Äôutilisateur voulait juste scroller) -->
                <ion-button
                  fill="outline"
                  size="small"
                  (click)="openYoutubeVideo(video); $event.stopPropagation()"
                >
                  Ouvrir sur YouTube
                </ion-button>
              </div>
            </ion-card-content>
          </ion-card>
        </div>
      </div>

      <!-- üü¶ Panneau PODCASTS -->
      <div class="media-panel podcasts-panel">
        <div class="media-intro">
          Retrouvez ici les derniers podcasts audio du GLC Baudour.
        </div>

        <!-- √âtat de chargement -->
        <div *ngIf="isLoadingPodcasts" class="media-state">
          Chargement des podcasts‚Ä¶
        </div>

        <!-- Erreur -->
        <div *ngIf="!isLoadingPodcasts && errorPodcasts" class="media-state error">
          {{ errorPodcasts }}
        </div>

        <!-- Liste des podcasts -->
        <div *ngIf="!isLoadingPodcasts && !errorPodcasts" class="podcast-list">
          <ion-card class="podcast-card" *ngFor="let p of podcasts">

            <ion-img
              *ngIf="p.imageUrl"
              [src]="p.imageUrl"
              [alt]="p.title"
              class="podcast-thumbnail"
            ></ion-img>

            <ion-card-content>
              <h2 class="podcast-title">{{ p.title }}</h2>
              <p class="podcast-date w-100">
                {{ p.publishedAt | date: 'longDate' }}
              </p>

              <ion-button
                fill="outline"
                size="small"
                (click)="openPodcastPlayer(p)"
              >
                √âcouter le podcast
              </ion-button>
            </ion-card-content>
          </ion-card>
        </div>
      </div>

    </div>
  </div>

  <!-- Modal podcast (lecteur audio int√©gr√©) -->
  <ion-modal
    [isOpen]="isPodcastModalOpen"
    (didDismiss)="closePodcastPlayer()"
    [breakpoints]="[0, 0.5, 1]"
    [initialBreakpoint]="0.5"
    handleBehavior="cycle"
  >
    <ng-template>
      <ion-content class="podcast-player-modal">
        <div class="podcast-player-header">
          <h2>{{ selectedPodcast?.title }}</h2>
          <ion-button fill="clear" (click)="closePodcastPlayer()">
            Fermer
          </ion-button>
        </div>

        <div class="podcast-player-body" *ngIf="selectedPodcast">
          <div class="podcast-audio-wrapper">
            <audio
              *ngIf="selectedPodcast.audioUrl"
              [src]="selectedPodcast.audioUrl"
              controls
            ></audio>
          </div>

          <p class="podcast-player-date">
            {{ selectedPodcast.publishedAt | date: 'longDate' }}
          </p>
          <p class="podcast-player-description" *ngIf="selectedPodcast.description">
            {{ selectedPodcast.description }}
          </p>
        </div>
      </ion-content>
    </ng-template>
  </ion-modal>
</ion-content>
