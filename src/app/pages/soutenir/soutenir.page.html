<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title>{{ pageTitle }}</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="soutenir-page">
  <div class="soutenir-container">
    <!-- Image Card (clic = ouvre la page web de don) -->
    <ion-card button (click)="openDonationPage()">
      <ion-card-content>
        <ion-img
          [src]="heroImageUrl"
          [alt]="pageTitle"
          class="soutenir-logo"
        />
      </ion-card-content>
    </ion-card>

    <!-- Description Card -->
    <ion-card>
      <ion-card-content>
        <div *ngIf="isLoadingContent">Chargement…</div>
        <div *ngIf="contentError" class="error-box"><p>{{ contentError }}</p></div>

        <div *ngIf="!isLoadingContent && !contentError" [innerHTML]="pageHtml"></div>
      </ion-card-content>
    </ion-card>

    <!-- Pay Button -->
    <ion-button class="don-btn" color="primary" (click)="openPaymentModal()">
      Faire un don
    </ion-button>
  </div>

  <!-- Payment Modal -->
  <ion-modal [isOpen]="isPaymentModalOpen" (didDismiss)="closePaymentModal()">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-title>Don</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="closePaymentModal()" [disabled]="isProcessingPayment">
              Fermer
            </ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>

      <ion-content class="payment-modal">
        <ion-card>
          <ion-card-content>
            <p class="payment-description">
              Sélectionnez un montant pour soutenir le GLC Baudour
            </p>

            <ion-grid>
              <ion-row>
                <ion-col size="6" *ngFor="let option of paymentOptions">
                  <ion-button
                    [fill]="selectedAmount === option.amount ? 'solid' : 'outline'"
                    [color]="selectedAmount === option.amount ? 'primary' : 'medium'"
                    expand="block"
                    (click)="selectAmount(option.amount)"
                    class="payment-option-btn"
                    [disabled]="isProcessingPayment"
                  >
                    {{ option.label }}
                  </ion-button>
                </ion-col>
              </ion-row>
            </ion-grid>

            <div *ngIf="selectedAmount" class="amount-display">
              <p class="amount-label">Montant</p>
              <p class="amount-value">€{{ selectedAmount }}.00</p>
            </div>

            <ion-button
              expand="block"
              color="primary"
              class="payment-submit-btn"
              [disabled]="!selectedAmount || isProcessingPayment"
              (click)="payNow()"
            >
              <ng-container *ngIf="!isProcessingPayment">Continuer vers le site</ng-container>
              <ng-container *ngIf="isProcessingPayment">
                <ion-spinner name="circular" style="width: 20px; height: 20px; margin-right: 8px;"></ion-spinner>
                Ouverture...
              </ng-container>
            </ion-button>

            <div *ngIf="paymentErrorMessage" class="error-box">
              <p>{{ paymentErrorMessage }}</p>
              <ion-button
                expand="block"
                fill="outline"
                color="medium"
                (click)="selectedAmount = null; paymentErrorMessage='';"
                size="small"
                [disabled]="isProcessingPayment"
              >
                Retour
              </ion-button>
            </div>
          </ion-card-content>
        </ion-card>
      </ion-content>
    </ng-template>
  </ion-modal>
</ion-content>
